<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="viewport"
          content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no"/>
    <title>天下VPN</title>
    <link href="https://fonts.googleapis.com/css?family=Hind|Oxygen" rel="stylesheet"/>
    <link rel="stylesheet" type="text/css" href="../static/css/normalize.css"/><!--CSS RESET-->
    <link rel="stylesheet" type="text/css" href="../static/css/htmleaf-demo.css"><!--演示页面样式，使用时可以不引用-->
    <!--Material Design Iconic Font-->
    <link rel="stylesheet" href="../static/material-design/css/material-design-iconic-font.css"/>
    <!--jSide Menu CSS-->
    <link rel="stylesheet" href="../static/css/jside-menu.css"/>
    <!--jSide Skins-->
    <link rel="stylesheet" href="../static/css/jside-skins.css"/>
    <link rel="stylesheet" href="../static/css/demo-only.css"/>

</head>
<style>
    .tc h3 {
        color: black;
        text-align: center;
        padding-top: 5px;
        line-height: 10px;
    }
    main article h1 {
        color: white;
    }
    .tc h2 {
        color: orangered;
        text-align: center;
        line-height: 3px;
    }

    .xdBtn{
        background-color: #0665d0;
        width: 100%;
        height: auto;
        color: white;
        outline: none;
        border: 0;
        font-size: 20px;
        border-radius: 3px;
        line-height: 45px;
    }
    .closeOrder{
        background-color: coral;
        width: 49%;
        height: auto;
        color: white;
        outline: none;
        border: 0;
        font-size: 18px;
        border-radius: 3px;
        line-height: 45px;
    }
</style>
<body>
<menu class="menubar">
    <menuitem>
        <button class="menu-trigger"></button>
    </menuitem>

    <menuitem class="logo" title="Your Logo Goes Here">
        <h6>天下数据</h6>
    </menuitem>
</menu>


<div class="menu-head">
	   <span class="layer">
	<div class="col">
	  <div class="row for-pic">
	   <div class="profile-pic">
	   <img src="../static/image/asif-mughal.jpg" alt="Asif Mughal"/>
	         </div>
	  </div>
	         <div class="row for-name">
	   <h3 title="User Name"> 售后问题反馈 </h3>
	        <span class="tagline"> kangoShy@gmail.com </span>
	          </div>
	         </div> <!--//col-->
	  </span>
</div> <!--//menu-head-->

<nav class="menu-container">

    <ul class="menu-items">

        <li><span class="item-icon"> <i class="zmdi zmdi-tv"></i> </span> <a href="/toIndex">
            首页 </a></li>

        <li><span class="item-icon"><i class="zmdi zmdi-android"></i></span> <a href="/androidCourse">
            Android 使用教程 </a></li>

        <li><span class="item-icon"> <i class="zmdi zmdi-apple"></i> </span> <a href="/iosCourse">
            IOS 使用教程 </a></li>

        <li class="has-sub"><span class="item-icon"> <i class="zmdi zmdi-windows"></i> </span>
            <a href="/windowsCourse">Windows 使用教程</a></li>

        <li class="has-sub"><span class="item-icon"> <i class="zmdi zmdi-devices"></i> </span>
            <a href="/macCourse">Mac 使用教程</a></li>


        <li><span class="item-icon"> <i class="zmdi zmdi-keyboard"></i> </span> <a href="#1">
            操作指南 </a></li>

        <li><span class="item-icon"> <i class="zmdi zmdi-dock"></i> </span> <a href="#1">
            关于我们 </a></li>


        <li><span class="item-icon"> <i class="zmdi zmdi-mouse"></i> </span> <a href="/customerService">
            联系客服 </a></li>

    </ul>


</nav>
<div class="dim-overlay"></div>

<!--End jSide Menu-->
<!--Introduction and Demo Only -->
<br><br>
<header class="intro">
    <!--<h1>jquery滑动侧边栏插件jSide</h1>
    <div class="htmleaf-links">
      <a class="htmleaf-icon icon-htmleaf-home-outline" href="http://www.htmleaf.com/" title="jQuery之家" target="_blank"><span> jQuery之家</span></a>
      <a class="htmleaf-icon icon-htmleaf-arrow-forward-outline" href="http://www.htmleaf.com/jQuery/Menu-Navigation/201810195376.html" title="返回下载页" target="_blank"><span> 返回下载页</span></a>
  </div>
    <p>
     jSide Menu is a well designed, simple and clean side navigation menu with dropdowns.
       <br />
       <br />
<b> Written in:</b><i> HTML, CSS, JS</i><br>
        <b> Frameworks: </b> <i>  jQuery 3.3.1 &amp; Material-Design-Iconic-Font 2.0  </i>
    </p>-->
</header>

<main>
    <article>
        <div style="text-align: center" id="appendOrderStatus">
            <h3>待支付</h3>
            <h4>支付完成后，掌柜将快速为您处理订单</h4>
        </div>
    </article>
</main>

<main>
    <article>
        <h3>商品信息</h3>
        <h4 style="color: #605e5e">产品名称：<span th:text="${comboName}"></span></h4>
        <h4 style="color: #605e5e">类型/周期：<span th:text="${comboType}"></span></h4>
        <h4 style="color: #605e5e">产品流量：<span>不限</span></h4>
    </article>
</main>

<main>
    <article>
        <h3>订单信息</h3>
        <h4 style="color: #605e5e">订单号：<span th:text="${orderId}"></span></h4>
        <h4 style="color: #605e5e">创建时间：<span th:text="${time}"></span></h4>
        <button class="closeOrder" id="closeOrderBtn" th:onclick="shutDownOrder([[${orderId}]], 1)">关闭订单</button>
        <button class="closeOrder" th:onclick="shutDownOrder([[${orderId}]], 2)">重新发起</button>
    </article>
</main>

<main>
    <article>
        <h4 style="color: red">注意：目前仅支持支付宝支付！</h4>
    </article>
</main>

<main style="background: rgb(52 55 60);color: white">
    <article>
        <h4><strong>订单总额</strong></h4>
        <h4><span th:text="${comboName}"></span> x <span th:text="${comboType}">月付</span></h4>
        <hr/>
        <br>
        <h3 style="color: #8183a8">总计</h3>
        <h1>￥<span id="zjje" th:text="${price}"></span>.00 CNY</h1>
        <button id="fk" th:onclick="invoicing([[${price}]],[[${orderId}]])" class="xdBtn">付款</button>
    </article>
</main>


<div class="htmleaf-container">
    <div class="related">
        <h6>
            本站由天下数据提供计算服务
        </h6>
        <!--<div style="font-size: 20%">
            商务合作：KangoShy@gmail.com
        </div>
        <div style="font-size: 1px">
            CopyRight 2021 天下数据（西安）有限公司 陕ICP备27463882号
        </div>-->
    </div>
</div>

<script src="../static/js/jquery-1.11.0.min.js" type="text/javascript"></script>
<script src="../static/js/jquery.jside.menu.js"></script>
<script src="../static/js/demo-only.js"></script>
<script>
    $(document).ready(function () {

        $(".menu-container").jSideMenu({
            jSidePosition: "position-left", //possible options position-left or position-right

            jSideSticky: true, // menubar will be fixed on top, false to set static

            jSideSkin: "default-skin", // to apply custom skin, just put its name in this string
        });
    });

    window.onload=function(){
        a();
    };

    let ddsx = false;
    //订单状态
    function a() {
        setInterval(function() {
            if (ddsx) return;
            getOrderStatus();}, 1000);
    }

    function getOrderStatus() {
        $.ajax({
            url:'/vpn/getOrderStatus',
            type:'GET',
            data:{'orderId':'[[${orderId}]]'},
            success:function(res) {
                let append;
                let data = res.data.status;
                let zcgb = res.data.zcgb;
                if (zcgb) {
                    append = "<h3>订单已关闭！</h3>";
                    document.getElementById("fk").setAttribute("disabled",true);
                    document.getElementById("fk").style.backgroundColor = '#8d9094';
                    document.getElementById("closeOrderBtn").setAttribute("disabled", true);
                    document.getElementById("closeOrderBtn").style.backgroundColor = '#8d9094';
                    ddsx = true;
                    $("#appendOrderStatus").html(append);
                    return;
                }
                if (data === '1') {
                    append = "<h3>付款成功！</h3>";
                    document.getElementById("fk").setAttribute("disabled",true);
                    document.getElementById("fk").style.backgroundColor = '#8d9094';
                    document.getElementById("closeOrderBtn").setAttribute("disabled", true);
                    document.getElementById("closeOrderBtn").style.backgroundColor = '#8d9094';
                    ddsx = true;
                }
                if (data === '2') {
                    append = "<h3>已超时！</h3>";
                    document.getElementById("fk").setAttribute("disabled",true);
                    document.getElementById("fk").style.backgroundColor = '#8d9094';
                    document.getElementById("closeOrderBtn").setAttribute("disabled", true);
                    document.getElementById("closeOrderBtn").style.backgroundColor = '#8d9094';
                    ddsx = true;
                }
                $("#appendOrderStatus").html(append);
            }
        })
    }

    function invoicing(price, orderId) {
        // $.ajax({
        //     url:'/vpn/pay',
        //     type: 'POST',
        //     dataType:'json',
        //     contentType: 'application/json; charset=UTF-8',
        //     data:JSON.stringify({'price':price, 'orderId': orderId}),
        //     success:function(res) {
        //         let code = res.code;
        //         if (code === "0000") {
        //             alert("支付成功！");
        //             // TODO 跳转我的订单页面
        //         }else{
        //             alert(res.message);
        //             window.location.href="/toIndex";
        //         }
        //     }
        // })
        // /////////////////////////
        // $.ajax({
        //     url:'/alipay/webPay',
        //     type: 'POST',
        //     dataType:'json',
        //     //contentType: 'application/json; charset=UTF-8',
        //     //data:JSON.stringify({'price':price, 'orderId': orderId}),
        //     success:function(res) {
        //         console.log(res);
        //     }
        // })
        window.location.href = "/toPay";
    }

    function shutDownOrder(orderId, val) {
        let msg = "重新发起不会保存当前订单，是否继续？";
        let clost = "确认要关闭当前订单？";
        if (val === 2) {
            if (confirm(msg) === false) {
                return;
            }
        }
        if (val === 1) {
            if (confirm(clost) === false) {
                return;
            }
        }
        $.ajax({
            url:'/vpn/closeOrder',
            type: 'GET',
            dataType:'json',
            data:{'orderId': orderId},
            success:function(res) {
                console.log(res);
                if (res.data) {
                    console.log("进入条件");
                    document.getElementById("fk").setAttribute("disabled",true);
                    document.getElementById("fk").style.backgroundColor = '#8d9094';
                    if (val === 2) {
                        window.location.href="/toIndex";
                    }
                }else{
                    alert("操作失败，请重试！");
                    document.getElementById("fk").setAttribute("disabled",false);
                    document.getElementById("fk").style.backgroundColor = '#0665d0';
                }
            }
        })
    }

</script>
</body>
</html>